!function(){"use strict";var t={popupSelector:document.querySelector("#popup_profile-editor"),buttonOpenPopup:document.querySelector(".profile__button-edit")},e={popupSelector:document.querySelector("#popup_avatar"),buttonOpenPopup:document.querySelector(".profile__update-avatar")},r={popupSelector:document.querySelector("#popup_add-card"),buttonOpenPopup:document.querySelector(".profile__button-add")},n={popupSelector:document.querySelector("#popup_picture")},o={popupSelector:document.querySelector("#popup_delete-card"),buttonSubmitForm:document.querySelector("#popup_delete-card").querySelector(".form__submit")},i=document.querySelector(".form_type_profile-editor"),u={selectorForm:i,inputList:Array.from(i.querySelectorAll(".form__input")),buttonSubmitForm:i.querySelector(".form__submit"),classErrorText:"form__error",classErrorInput:"form__input_type_error",errorList:Array.from(i.querySelectorAll(".form__error")),inputName:i.querySelector('input[name="name"]'),inputAbout:i.querySelector('input[name="about"]'),inactiveButtonClass:"form__submit_inactive"},a=document.querySelector(".form_type_avatar"),c={selectorForm:a,inputList:Array.from(a.querySelectorAll(".form__input")),buttonSubmitForm:a.querySelector(".form__submit"),classErrorText:"form__error",classErrorInput:"form__input_type_error",errorList:Array.from(a.querySelectorAll(".form__error")),inputLink:a.querySelector('input[name="link"]'),inactiveButtonClass:"form__submit_inactive"},s={name:document.querySelector(".profile__name"),about:document.querySelector(".profile__about-me"),avatar:document.querySelector(".profile__avatar")},l=document.querySelector(".form_type_add-card"),f={selectorForm:l,inputList:Array.from(l.querySelectorAll(".form__input")),buttonSubmitForm:l.querySelector(".form__submit"),classErrorText:"form__error",classErrorInput:"form__input_type_error",errorList:Array.from(l.querySelectorAll(".form__error")),inputLocation:l.querySelector('input[name="location"]'),inputLink:l.querySelector('input[name="link"]'),inactiveButtonClass:"form__submit_inactive"},p=document.querySelector(".cards");function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t){return t.ok?t.json():Promise.Promise.reject("Ошибка method: ".concat(t))}var d=function(){function t(e){var r=e.url,n=e.headers;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=r,this._headers=n}var e,r;return e=t,(r=[{key:"getUser",value:function(){return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:this._headers}).then(m)}},{key:"patchUser",value:function(t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(t)}).then(m)}},{key:"patchAvatar",value:function(t){var e=t.link;return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(m)}},{key:"getCards",value:function(){return fetch("".concat(this._url,"/cards"),{method:"GET",headers:this._headers}).then(m)}},{key:"addCard",value:function(t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify(t)}).then(m)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:this._headers}).then(m)}},{key:"toggleCardLike",value:function(t,e){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:e,headers:this._headers}).then(m)}}])&&h(e.prototype,r),t}();function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupSelector=e.popupSelector,this._buttonClosePopup=this._popupSelector.querySelector(".popup__close"),this._popupContainer=this._popupSelector.querySelector(".popup__container"),this.wrapperClickOverlay=function(t){return r._clickOverlay.call(r,t)},this.wrapperClickButtonClose=function(t){return r._clickButtonClose.call(r,t)},this.wrapperHandleEscClose=function(t){return r._handleEscClose.call(r,t)}}var e,r;return e=t,(r=[{key:"open",value:function(){this._popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this.wrapperHandleEscClose)}},{key:"close",value:function(){this._popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this.wrapperHandleEscClose)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"_clickOverlay",value:function(t){t.target===this._popupSelector&&this.close()}},{key:"_clickButtonClose",value:function(t){t.target===this._buttonClosePopup&&this.close()}},{key:"setEventListeners",value:function(){this._popupSelector.addEventListener("mousedown",this.wrapperClickOverlay),this._popupSelector.addEventListener("click",this.wrapperClickButtonClose)}}])&&b(e.prototype,r),t}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e,r){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},k(t,e,r||t)}function S(t,e){return S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},S(t,e)}function C(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return g(t)}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(n);if(o){var r=w(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return C(this,t)});function u(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(r=i.call(this,t))._handleFormSubmit=e,r._formSelector=r._popupSelector.querySelector(".form"),r.wrapperSubmitForm=function(t){return r._submitForm.call(g(r),t)},r}return e=u,(r=[{key:"close",value:function(){k(w(u.prototype),"close",this).call(this)}},{key:"_submitForm",value:function(t){this._handleFormSubmit(t)}},{key:"setEventListeners",value:function(){k(w(u.prototype),"setEventListeners",this).call(this),this._formSelector.addEventListener("submit",this.wrapperSubmitForm)}}])&&v(e.prototype,r),u}(_);function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var L=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._selectorForm=e.selectorForm,this._inputList=e.inputList,this._classErrorText=e.classErrorText,this._classErrorInput=e.classErrorInput,this._buttonSubmitForm=e.buttonSubmitForm,this.errorList=e.errorList,this._inactiveButtonClass=e.inactiveButtonClass}var e,r;return e=t,(r=[{key:"_showInputError",value:function(t,e,r){t.classList.add(this._classErrorInput),this._selectorForm.querySelector("."+e).textContent=r}},{key:"_hideInputError",value:function(t,e){t.classList.remove(this._classErrorInput),this._selectorForm.querySelector("."+e).textContent=""}},{key:"_isValid",value:function(t){this.errorClass=this._classErrorText+"-".concat(t.getAttribute("name")),t.validity.valid?this._hideInputError(t,this.errorClass):this._showInputError(t,this.errorClass,t.validationMessage)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"disableButtonForm",value:function(){this._buttonSubmitForm.setAttribute("disabled",!0),this._buttonSubmitForm.classList.add(this._inactiveButtonClass)}},{key:"activateButtonForm",value:function(){this._buttonSubmitForm.removeAttribute("disabled"),this._buttonSubmitForm.classList.remove(this._inactiveButtonClass)}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput(this._inputList)?this.disableButtonForm():this.activateButtonForm()}},{key:"enableValidation",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._isValid(e),t._toggleButtonState()}))}))}},{key:"clearValidation",value:function(){var t=this;this._inputList.forEach((function(e){e.classList.remove(t._classErrorInput)})),this.errorList.forEach((function(t){t.textContent=""})),this._toggleButtonState()}}])&&E(e.prototype,r),t}();function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var F=function(){function t(e,r){var n=e.item,o=e.handleCardClick,i=e.handleLikeClick,u=e.handleDeleteClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.item=n,this.name=n.name,this.link=n.link,this.likes=n.likes,this.cardId=n._id,this.ownerId=n.owner._id,this.currentUser=n.currentUser,this._nubmerOfLikes=n.likes.length,this._cardSelector=r,this._handleCardClick=o,this._handleLikeClick=i,this._handleDeleteClick=u}var e,r;return e=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_openPicture",value:function(){this._handleCardClick(this.name,this.link)}},{key:"liked",value:function(t){t?(this._buttonCardLike.classList.remove("card__like_active"),this._numberingOfLikes.textContent=this._nubmerOfLikes):(this._buttonCardLike.classList.add("card__like_active"),this._numberingOfLikes.textContent=this._nubmerOfLikes)}},{key:"setArrayLikes",value:function(t){this.likes=t,this._nubmerOfLikes=t.length}},{key:"removeElement",value:function(){this._element.remove()}},{key:"_setEventListeners",value:function(){var t=this;this._buttonCardLike.addEventListener("click",(function(){return t._handleLikeClick(t)})),this._cardPicture.addEventListener("click",this._openPicture.bind(this)),this._cardButtonRemove.addEventListener("click",(function(){return t._handleDeleteClick(t)}))}},{key:"generateCard",value:function(){var t=this;return this._element=this._getTemplate(),this._cardName=this._element.querySelector(".card__title"),this._cardPicture=this._element.querySelector(".card__picture"),this._buttonCardLike=this._element.querySelector(".card__like"),this._numberingOfLikes=this._element.querySelector(".card__number-of-likes"),this._cardButtonRemove=this._element.querySelector(".card__remove"),this._setEventListeners(),this._cardName.textContent=this.name,this._cardPicture.alt=this.name,this._cardPicture.src=this.link,this._numberingOfLikes.textContent=this._nubmerOfLikes,this.likes.some((function(e){return e._id==t.currentUser}))&&this._buttonCardLike.classList.add("card__like_active"),this.currentUser!=this.ownerId&&this._cardButtonRemove.remove(),this._element}}])&&P(e.prototype,r),t}();function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var q=function(){function t(e,r){var n=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=n,this._selectorCotainer=r}var e,r;return e=t,(r=[{key:"renderItems",value:function(t){var e=this;this._renderedItems=t,this._renderedItems.forEach((function(t){return e._renderer(t)}))}},{key:"addItem",value:function(t){this._selectorCotainer.prepend(t)}}])&&A(e.prototype,r),t}();function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function T(t,e,r){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},T(t,e,r||t)}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function B(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}var U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=R(n);if(o){var r=R(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return B(this,t)});function u(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this,t)}return e=u,(r=[{key:"open",value:function(t){var e=t.nameImage,r=t.linkImage;T(R(u.prototype),"open",this).call(this),this._popupPictureCardImage=this._popupSelector.querySelector(".pictures-block__img"),this._popupPictureCardTitle=this._popupSelector.querySelector(".pictures-block__title"),this._popupPictureCardImage.src=r,this._popupPictureCardImage.setAttribute("alt",e),this._popupPictureCardTitle.textContent=e}}])&&I(e.prototype,r),u}(_);function D(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var N=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._selectorName=e.name,this._selectorAbout=e.about,this._selectorAvatar=e.avatar}var e,r;return e=t,(r=[{key:"setUserInfo",value:function(t){this._selectorName.textContent=t.name,this._selectorAbout.textContent=t.about}},{key:"setUserAvatar",value:function(t){this._selectorAvatar.alt=t.name,this._selectorAvatar.src=t.avatar}}])&&D(e.prototype,r),t}();function V(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function H(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?V(Object(r),!0).forEach((function(e){J(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function J(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var M=new d({url:"https://mesto.nomoreparties.co/v1/cohort-30",headers:{authorization:"d212ae53-16c4-4655-af75-395db9babc88","Content-Type":"application/json"}}),z=new N(s),$=new O(t,Y),K=new _(o),Q=new q({renderer:function(t){var e=ot(t).generateCard();Q.addItem(e)}},p);new L(u).enableValidation(),new L(c).enableValidation();var W=new L(f);W.enableValidation();var X=null;Promise.all([M.getCards(),M.getUser()]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],u=!0,a=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);u=!0);}catch(t){a=!0,o=t}finally{try{u||null==r.return||r.return()}finally{if(a)throw o}}return i}}(e,r)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?G(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1];X=i._id,z.setUserInfo(i),z.setUserAvatar(i),Q.renderItems(o)})).catch((function(t){return console.log(t)}));var Y=function(t){t.preventDefault(),u.buttonSubmitForm.textContent="Загрузка...",u.buttonSubmitForm.setAttribute("disabled",!0),M.patchUser({name:u.inputName.value,about:u.inputAbout.value}).then((function(t){z.setUserInfo(t),z.setUserAvatar(t),u.buttonSubmitForm.textContent="Готово",setTimeout($.close(),500),setTimeout((function(){u.buttonSubmitForm.removeAttribute("disabled"),u.buttonSubmitForm.textContent="Сохранить"}),500)})).catch((function(t){return console.log(t)}))};$.setEventListeners(),t.buttonOpenPopup.addEventListener("click",(function(){M.getUser().then((function(t){u.inputName.value=t.name,u.inputAbout.value=t.about,$.open()})).catch((function(t){return console.log(t)}))}));var Z=new O(e,(function(t){t.preventDefault(),c.buttonSubmitForm.textContent="Загрузка...",c.buttonSubmitForm.setAttribute("disabled",!0),M.patchAvatar({link:c.inputLink.value}).then((function(t){z.setUserAvatar(t),c.buttonSubmitForm.textContent="Готово",setTimeout(Z.close(),500),setTimeout((function(){c.buttonSubmitForm.removeAttribute("disabled"),c.buttonSubmitForm.textContent="Сохранить"}),500)})).catch((function(t){return console.log(t)}))}));Z.setEventListeners(),e.buttonOpenPopup.addEventListener("click",(function(){return Z.open()}));var tt=new U(n);tt.setEventListeners();var et=function(t,e){tt.open({nameImage:t,linkImage:e})},rt=function(t){var e=t.likes.some((function(e){return e._id==t.currentUser}));M.toggleCardLike(t.cardId,e?"DELETE":"PUT").then((function(r){t.setArrayLikes(r.likes),t.liked(e)})).catch((function(t){return console.log(t)}))},nt=function(t){K.open(),o.buttonSubmitForm.addEventListener("click",(function(e){e.preventDefault(),o.buttonSubmitForm.textContent="Удаляем...",o.buttonSubmitForm.setAttribute("disabled",!0),M.deleteCard(t.cardId).then((function(e){t.removeElement(),o.buttonSubmitForm.textContent=e.message,setTimeout(K.close(),500),setTimeout((function(){o.buttonSubmitForm.removeAttribute("disabled"),o.buttonSubmitForm.textContent="Да"}),500)})).catch((function(t){return console.log(t)}))}))},ot=function(t){return new F({item:H(H({},t),{},{currentUser:X}),handleCardClick:et,handleLikeClick:rt,handleDeleteClick:nt},"#card")};r.buttonOpenPopup.addEventListener("click",(function(){return it.open()}));var it=new O(r,(function(t){t.preventDefault(),f.buttonSubmitForm.textContent="Загрузка...",f.buttonSubmitForm.setAttribute("disabled",!0),M.addCard({name:f.inputLocation.value,link:f.inputLink.value}).then((function(t){var e=ot(t).generateCard();Q.addItem(e),f.buttonSubmitForm.textContent="Готово",setTimeout(it.close(),500),setTimeout((function(){f.buttonSubmitForm.removeAttribute("disabled"),f.buttonSubmitForm.textContent="Сохранить"}),500)})).catch((function(t){return console.log(t)})),f.selectorForm.reset(),W.disableButtonForm()}));it.setEventListeners()}();